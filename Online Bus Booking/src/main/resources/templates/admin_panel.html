<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>AdminPanel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">AdminPanel</a>
        <div class="text-white">Welcome, <span th:text="${name}"></span></div>
    </div>
</nav>

<div class="container mt-4">
    <h3 class="text-center mb-3">Bus Management</h3>

    <!-- Add New Bus Form -->
    <div class="card mb-4">
        <div class="card-header">Add New Bus</div>
        <div class="card-body">
            <form th:action="@{/add_bus}" method="post">
                <div class="row g-2">
                    <div class="col-md-3"><input class="form-control" type="text" name="busNumber" placeholder="Bus Number" required></div>
                    <div class="col-md-3"><input class="form-control" type="text" name="timing" placeholder="Timing" required></div>
                    <div class="col-md-3">
                        <select class="form-select" name="route.id" required>
                            <option value="">-- Select Route --</option>
                            <option th:each="r : ${routes}" th:value="${r.id}" th:text="${r.source + ' → ' + r.destination}"></option>
                        </select>
                    </div>
                    <div class="col-md-2"><input class="form-control" type="number" name="seats" placeholder="Seats" value="40" required></div>
                    <div class="col-md-1"><button type="submit" class="btn btn-success w-100">Add</button></div>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Bus Form -->
    <div th:if="${editBus != null}" class="card mb-4">
        <div class="card-header bg-warning">Edit Bus</div>
        <div class="card-body">
            <form th:action="@{/update_bus}" method="post">
                <input type="hidden" name="id" th:value="${editBus.id}" />
                <div class="row g-2">
                    <div class="col-md-3"><input class="form-control" type="text" name="busNumber" th:value="${editBus.busNumber}" required></div>
                    <div class="col-md-3"><input class="form-control" type="text" name="timing" th:value="${editBus.timing}" required></div>
                    <div class="col-md-3">
                        <select class="form-select" name="route.id" required>
                            <option value="">-- Select Route --</option>
                            <option th:each="r : ${routes}" th:value="${r.id}" th:text="${r.source + ' → ' + r.destination}"
                                    th:selected="${r.id == editBus.route.id}"></option>
                        </select>
                    </div>
                    <div class="col-md-2"><input class="form-control" type="number" name="seats" th:value="${editBus.seats}" required></div>
                    <div class="col-md-1"><button type="submit" class="btn btn-primary w-100">Update</button></div>
                </div>
            </form>
        </div>
    </div>

    <!-- Bus Table -->
    <table class="table table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Bus Number</th>
                <th>Timing</th>
                <th>Route</th>
                <th>Seats</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="bus : ${buses}">
                <td th:text="${bus.id}"></td>
                <td th:text="${bus.busNumber}"></td>
                <td th:text="${bus.timing}"></td>
                <td th:text="${bus.route.source + ' → ' + bus.route.destination}"></td>
                <td th:text="${bus.seats}"></td>
                <td>
                    <a th:href="@{/edit_bus/{id}(id=${bus.id})}" class="btn btn-warning btn-sm">Edit</a>
                    <a th:href="@{/delete_bus/{id}(id=${bus.id})}" class="btn btn-danger btn-sm">Delete</a>
                </td>
            </tr>
        </tbody>
    </table>
</div>

</body>
</html>
